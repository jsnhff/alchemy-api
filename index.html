<!DOCTYPE html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Fun test</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
        <!-- Add your site or application content here -->
        <p>Alchemy API Site</p>
        <p id="analysis">sentiment analysis</p>
        <p id="words">words</p>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')</script>
        <script src="js/plugins.js"></script>
        <script src="js/main.js"></script>
        <script src="js/vendor/rita-micro.js"></script>
        <script>
            //var alchemyTextSent = "http://access.alchemyapi.com/calls/url/URLGetTextSentiment";
            var alchemyTextSent = "http://access.alchemyapi.com/calls/text/TextGetTextSentiment";
            var apikey = "eaada21b94f8b0859f447d403dd7f3327652d9c8";
            var sourceText = "https://raw.githubusercontent.com/jsnhff/sentimental-poetry/master/test_doc.xml"; 
            var outputMode = "json";
            var sentiment = "1";
           
            var tokens;
            
            var xmlDoc;
            
            $.ajax({
                url : sourceText,
                dataType: "xml",
                success : function (data) {
                    words = $(data).find('Story').text();
                    tokens = RiTa.tokenize(words);
                    
                    console.log($(data).find('Story').text());
                    
                    // Build DOM so targets can match and words and classes can be added
                    $(tokens).each(function(i) {
                        $("#analysis").append("<span id='" + i + "'></span>");
                        
                        $(data).find('Story').text(function() {
                            return $(this).text().replace(tokens[i], "<neutral class='fart'>pig</neutral>"); 
                        });
                    });

                    // Run analyze function on each word and send target along to keep order serialized
                    $(tokens).each(function(i) {
                        //analyzeWord(tokens[i], i);
                    });
                    
                    console.log($(data).find('Story').text());
                   
                }
            });


            var analyzeWord = function(word, target){
                //var urlQuery = alchemyTextSent + "?url=" + sourceText + "&apikey=" + apikey + "&outputMode=" + outputMode;
                var urlQuery = alchemyTextSent + "?&apikey=" + apikey + "&text=" + word + "&outputMode=" + outputMode;

                $.ajax({
                    url: urlQuery,
                    success: function(results) {
                        console.log("Success: " + target + " " + word + " Analysis: " + results.docSentiment.type);
                        if (results.docSentiment.score == null){
                            var score = "0.000000";
                        } else {
                            var score = results.docSentiment.score;
                        };
                        $("#"+target).addClass(results.docSentiment.type).attr("data-value", score).text(word);
                    }
                });
            }
        </script>
    </body>
</html>
